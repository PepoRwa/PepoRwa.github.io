<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRX | INTELLIGENCE_FEED</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Share+Tech+Mono&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <script src="/global.js" defer></script>
    
    <style>
        :root { --abyss: #0B0C15; --magenta: #D62F7F; }
        body { background: var(--abyss); color: #fff; font-family: 'Montserrat', sans-serif; overflow-x: hidden; }
        .tech-font { font-family: 'Share Tech Mono', monospace; }
        .title-font { font-family: 'Rajdhani', sans-serif; }
        
        canvas { position: fixed; inset: 0; z-index: 0; pointer-events: none; }

        /* Navigation Standard */
        .nav-link { transition: 0.4s; letter-spacing: 0.2em; position: relative; opacity: 0.6; }
        .nav-link:hover { color: var(--magenta); text-shadow: 0 0 10px var(--magenta); opacity: 1 !important; }
        
        #mobile-nav { 
            display: none;
            background: rgba(2, 2, 5, 0.98);
            backdrop-filter: blur(20px);
        }
        #mobile-nav.active { display: flex; }

        .news-card {
            background: rgba(26, 28, 46, 0.4);
            border: 1px solid rgba(214, 47, 127, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            backdrop-filter: blur(8px);
        }
        .news-card:hover {
            border-color: var(--magenta);
            transform: translateY(-5px);
            background: rgba(214, 47, 127, 0.08);
            box-shadow: 0 10px 30px rgba(214, 47, 127, 0.1);
        }
        .tag {
            font-size: 8px;
            padding: 2px 8px;
            border: 1px solid var(--magenta);
            color: var(--magenta);
            text-transform: uppercase;
        }
        
        .search-bar {
            background: rgba(0,0,0,0.5);
            border: 1px solid rgba(214, 47, 127, 0.2);
            color: white;
            padding: 10px 20px;
            font-family: 'Share Tech Mono';
            transition: 0.3s;
        }
        .search-bar:focus { border-color: var(--magenta); outline: none; background: rgba(214, 47, 127, 0.05); }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: var(--abyss); }
        ::-webkit-scrollbar-thumb { background: var(--magenta); }

        #custom-cursor { width: 30px; height: 30px; border: 1px solid var(--magenta); position: fixed; pointer-events: none !important; z-index: 1000000; border-radius: 50%; transition: transform 0.1s ease-out; transform: translate(-50%, -50%); box-shadow: 0 0 15px var(--magenta); display: none; }
        #custom-cursor::after { content: ''; position: absolute; top: 50%; left: 50%; width: 4px; height: 4px; background: var(--magenta); border-radius: 50%; transform: translate(-50%, -50%); }
        @media (min-width: 1024px) { body, html, * { cursor: none !important; } #custom-cursor { display: block; } }
    </style>
</head>
<body class="bg-[#050508]">

    <div id="custom-cursor"></div>
    <canvas id="starCanvas"></canvas>

    <header class="relative z-[100] p-6 flex justify-between items-center border-b border-white/10 backdrop-blur-xl bg-black/40">
        <div class="flex items-center gap-4">
            <div class="w-8 h-8 border border-magenta rotate-45 flex items-center justify-center">
                <div class="w-4 h-4 bg-magenta animate-pulse rotate-[-45deg]"></div>
            </div>
            <div class="font-rajdhani font-bold text-2xl text-white tracking-tighter uppercase leading-none">
                GOWRAX<span class="text-magenta italic">_ARCHIVES</span>
            </div>
        </div>
        
        <nav class="hidden lg:flex space-x-10 text-[10px] font-bold tracking-[0.4em] tech-font">
            <a href="/" class="nav-link">INDEX</a>
            <a href="/news/index.html" class="text-magenta underline underline-offset-8 decoration-2">NEWS</a>
            <a href="/staff/index.html" class="nav-link">STAFF</a>
            <a href="/ceo/index.html" class="nav-link">COMMAND</a>
            <a href="/profiles/index.html" class="nav-link">DATABASE</a>
            <a href="/roster/index.html" class="nav-link">UNITS</a>
            <a href="/contact/index.html" class="nav-link">SIGNAL</a>
        </nav>

        <div class="flex items-center">
            <button onclick="toggleNav(true)" class="lg:hidden text-magenta border border-magenta/40 p-2 hover:bg-magenta hover:text-white transition-all">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
            </button>
        </div>
    </header>

    <div id="mobile-nav" class="fixed inset-0 z-[999999] p-12 flex flex-col justify-center items-center space-y-8 opacity-0 pointer-events-none transition-all duration-500">
        <button onclick="toggleNav(false)" class="absolute top-10 right-10 text-magenta font-mono text-sm border border-magenta/40 px-6 py-2 uppercase pointer-events-auto">Close_X</button>
        <a href="/" class="text-4xl font-rajdhani font-bold text-magenta italic pointer-events-auto" onclick="toggleNav(false)">INDEX</a>
        <a href="/news/index.html" class="text-2xl font-rajdhani tracking-widest pointer-events-auto" onclick="toggleNav(false)">NEWS</a>
            <a href="/staff/index.html" class="text-2xl font-rajdhani tracking-widest pointer-events-auto" onclick="toggleNav(false)">STAFF</a>
        <a href="/ceo/index.html" class="text-2xl font-rajdhani tracking-widest pointer-events-auto" onclick="toggleNav(false)">COMMAND</a>
        <a href="/profiles/index.html" class="text-2xl font-rajdhani tracking-widest pointer-events-auto" onclick="toggleNav(false)">DATABASE</a>
        <a href="/roster/index.html" class="text-2xl font-rajdhani tracking-widest pointer-events-auto" onclick="toggleNav(false)">ROSTERS</a>
        <a href="/contact/index.html" class="text-2xl font-rajdhani tracking-widest border border-magenta/40 px-10 py-3 text-magenta pointer-events-auto" onclick="toggleNav(false)">SIGNAL</a>
    </div>

    <div class="relative z-10 p-6 md:p-12 max-w-7xl mx-auto">
        
        <header class="flex flex-col md:flex-row justify-between items-center md:items-end mb-20 border-b border-magenta/20 pb-8 gap-6">
            <div class="text-center md:text-left">
                <span class="tech-font text-magenta text-xs tracking-[0.5em] uppercase block mb-2">// Archives_Gowrax</span>
                <h1 class="title-font text-5xl md:text-7xl font-bold uppercase italic tracking-tighter">News_<span class="text-magenta">Report</span></h1>
            </div>
            <div class="flex flex-col items-center md:items-end gap-4 w-full md:w-auto">
                <input type="text" id="search" placeholder="RECHERCHER_DANS_LA_BASE..." class="search-bar text-xs uppercase tracking-widest w-full md:w-80">
            </div>
        </header>

        <section class="mb-24">
            <h3 class="tech-font text-magenta text-[10px] tracking-[0.3em] uppercase mb-8 italic underline underline-offset-4 font-bold">// Last_3_Updates</h3>
            <div id="featured-news" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="animate-pulse tech-font text-gray-600 uppercase text-xs tracking-widest">Initialisation de la liaison satellite...</div>
            </div>
        </section>

        <section class="pb-20">
             <h3 class="tech-font text-magenta text-[10px] tracking-[0.3em] uppercase mb-8 italic underline underline-offset-4 font-bold">// Database_Full_Access</h3>
             <div id="archives-news" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                 </div>
        </section>

    </div>

    <script>
        const SUPABASE_URL = 'https://nvtcjaallxoweujbyhng.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im52dGNqYWFsbHhvd2V1amJ5aG5nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4NDc4OTEsImV4cCI6MjA4NzQyMzg5MX0.a0FkgYwG3yxu0GMXA6wV-6GqFamB9Pu-E57_z6KkHik';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        marked.setOptions({ breaks: true, gfm: true });

        // Navigation mobile
        function toggleNav(state) { 
            const nav = document.getElementById('mobile-nav');
            if(state) {
                nav.classList.add('active');
                setTimeout(() => {
                    nav.style.opacity = '1';
                    nav.style.pointerEvents = 'auto';
                }, 10);
                document.body.style.overflow = 'hidden';
            } else {
                nav.style.opacity = '0';
                nav.style.pointerEvents = 'none';
                setTimeout(() => nav.classList.remove('active'), 500);
                document.body.style.overflow = 'auto';
            }
        }

        async function fetchNews() {
            const { data: posts, error } = await _supabase
                .from('posts')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) return console.error("Erreur de liaison satellite.");
            renderNews(posts);
        }

        function createCardHTML(post) {
            const date = new Date(post.created_at).toLocaleDateString('fr-FR');
            const excerpt = post.content.replace(/[#*`_]/g, '').substring(0, 100) + '...';
            
            return `
                <div class="news-card p-6 flex flex-col justify-between h-full group" onclick="window.location.href='./post.html?slug=${post.slug}'">
                    <div>
                        <div class="flex justify-between items-start mb-4">
                            <span class="tech-font text-[9px] text-gray-500">${date}</span>
                            <div class="flex gap-2 flex-wrap justify-end">
                                ${post.tags ? post.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : ''}
                            </div>
                        </div>
                        <h2 class="title-font text-2xl font-bold uppercase tracking-tight group-hover:text-magenta transition mb-3">${post.title}</h2>
                        <p class="text-[10px] text-gray-400 tech-font leading-relaxed opacity-80 group-hover:opacity-100 transition">${excerpt}</p>
                    </div>
                    <div class="mt-6 flex justify-between items-center border-t border-white/5 pt-4">
                        <span class="tech-font text-[8px] text-magenta font-bold">OUVRIR_DOSSIER_</span>
                        <span class="tech-font text-[8px] text-gray-600">REF: ${post.slug.substring(0,15).toUpperCase()}</span>
                    </div>
                </div>
            `;
        }

        function renderNews(posts) {
            const featuredContainer = document.getElementById('featured-news');
            const archivesContainer = document.getElementById('archives-news');
            featuredContainer.innerHTML = '';
            archivesContainer.innerHTML = '';

            posts.forEach((post, index) => {
                const cardHTML = createCardHTML(post);
                if (index < 3) featuredContainer.innerHTML += cardHTML;
                archivesContainer.innerHTML += cardHTML;
            });
        }

        document.getElementById('search').addEventListener('input', async (e) => {
            const term = e.target.value.toLowerCase();
            const { data: posts } = await _supabase.from('posts').select('*').ilike('title', `%${term}%`);
            renderNews(posts);
        });

        fetchNews();

        // CANVAS
        const canvas = document.getElementById('starCanvas');
        const ctx = canvas.getContext('2d');
        let stars = [];
        let shootingStars = [];

        function initStars() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            stars = [];
            const count = window.innerWidth < 768 ? 80 : 200;
            for(let i=0; i<count; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 1.2,
                    opacity: Math.random(),
                    speed: Math.random() * 0.02
                });
            }
        }

        function createShootingStar() {
            shootingStars.push({
                x: Math.random() * canvas.width,
                y: 0,
                len: Math.random() * 80 + 30,
                speed: Math.random() * 10 + 6,
                opacity: 1
            });
        }

        function animateStars() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#050508";
            ctx.fillRect(0,0, canvas.width, canvas.height);

            stars.forEach(s => {
                s.opacity += s.speed;
                if(s.opacity > 1 || s.opacity < 0) s.speed *= -1;
                ctx.fillStyle = `rgba(255, 255, 255, ${s.opacity})`;
                ctx.fillRect(s.x, s.y, s.size, s.size);
            });

            shootingStars.forEach((ss, i) => {
                ss.x -= ss.speed; ss.y += ss.speed; ss.opacity -= 0.02;
                ctx.strokeStyle = `rgba(214, 47, 127, ${ss.opacity})`;
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                ctx.moveTo(ss.x, ss.y);
                ctx.lineTo(ss.x + ss.len, ss.y - ss.len);
                ctx.stroke();
                if(ss.opacity <= 0) shootingStars.splice(i, 1);
            });
            if(Math.random() < 0.03) createShootingStar();
            requestAnimationFrame(animateStars);
        }

        initStars(); animateStars();
        window.addEventListener('resize', initStars);

        const cursor = document.getElementById('custom-cursor');
        window.addEventListener('mousemove', e => {
            cursor.style.left = e.clientX + 'px'; 
            cursor.style.top = e.clientY + 'px'; 
        });
    </script>
</body>
</html>